<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Schnell + rembg API Tester</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body{font-family:sans-serif;max-width:860px;margin:32px auto;padding:0 16px}
  h1{margin-bottom:8px}
  small{color:#666}
  .row{display:flex;gap:12px;flex-wrap:wrap;margin:12px 0}
  input[type="text"]{flex:1;padding:10px}
  button{padding:10px 14px;cursor:pointer}
  img{max-width:100%;margin-top:12px;border-radius:10px;box-shadow:0 4px 14px rgba(0,0,0,.1)}
  .pill{display:inline-block;padding:6px 10px;border-radius:9999px;background:#f3f4f6;margin:6px 6px 0 0}
</style>
</head>
<body>
  <h1>ðŸš€ Schnell (HF API) + rembg (Local) Tester</h1>
  <div class="row">
    <div class="pill" id="ver">Checking rembgâ€¦</div>
    <div class="pill" id="health">Checking healthâ€¦</div>
  </div>

  <h3>Generate (Schnell via HF API)</h3>
  <div class="row">
    <input id="prompt" type="text" placeholder="Bangladeshi girl in red sari, ultra realistic" />
    <button onclick="gen()">Generate</button>
  </div>

  <h3>Remove Background (rembg local)</h3>
  <div class="row">
    <input id="file" type="file" accept="image/*" />
    <button onclick="doRembg()">Remove BG</button>
  </div>

  <img id="out" alt="Output will appear here"/>

<script>
const out = document.getElementById("out");
async function gen(){
  const prompt = document.getElementById("prompt").value.trim();
  if(!prompt) return alert("Write a prompt");
  out.src = ""; out.alt = "Generatingâ€¦";
  const res = await fetch("/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt})});
  if(!res.ok){ alert("Generate failed"); return; }
  const blob = await res.blob();
  out.src = URL.createObjectURL(blob);
  out.alt = "Generated";
}
async function doRembg(){
  const f = document.getElementById("file").files[0];
  if(!f) return alert("Choose an image");
  out.src = ""; out.alt = "Removing backgroundâ€¦";
  const fd = new FormData();
  fd.append("image", f);
  const res = await fetch("/rembg",{method:"POST",body:fd});
  if(!res.ok){ alert("Rembg failed"); return; }
  const blob = await res.blob();
  out.src = URL.createObjectURL(blob);
  out.alt = "Background removed";
}
(async()=>{
  try{
    const v = await fetch("/rembg-version"); 
    if(v.ok){ const j = await v.json(); document.getElementById("ver").textContent = "rembg v"+j.version; }
    else document.getElementById("ver").textContent = "rembg not available";
  }catch{ document.getElementById("ver").textContent = "rembg not available"; }
  try{
    const h = await fetch("/healthz");
    document.getElementById("health").textContent = h.ok ? "API healthy" : "API not healthy";
  }catch{ document.getElementById("health").textContent = "API not healthy"; }
})();
</script>
</body>
</html>
